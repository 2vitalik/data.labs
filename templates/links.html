{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}–ü–æ—Ç—ñ–∫ {{ prefix }}{% endblock %}

{% block css %}
<style>
    small {
        margin-top: 2px;
        display: flex;
        flex-direction: column;
        line-height: 1.2;
        color: #bbb;
    }
    .gray-links, .gray-links a {
        color: #888;
    }
    .gray-links a:hover {
        color: #555;
    }
    .silver-links, .silver-links a {
        color: #ccc;
    }
    .silver-links a:hover {
        color: #aaa;
    }
</style>
{% endblock %}

{% block content %}
    <h1 class="h3 mb-3">
        –ü–æ—Ç—ñ–∫ {{ prefix }}
        {% if mode == 'view' and subjects %}
            (<a href="{% url 'links-edit' key %}">—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>)
        {% elif mode == 'edit' %}
            <span class="text-danger">[—Ä–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è]</span>
        {% endif %}
    </h1>

    {% if mode == 'edit' and subjects %}
    <form method="post">
        {% csrf_token %}
        {% include 'includes/buttons.html' %}
    {% endif %}

    {% for subject, subject_data in subjects.items %}
        <h2 id="{{ subject }}" class="h5 mb-0 pt-4">
            üìö <b>{{ subject }}</b>
            ‚Äî {{ subjects_names|get:subject }}
        </h2>
        <div class="gray-links small mb-2 text-end">
            <a href="#{{ subject }}">#—è–∫—ñ—Ä</a>
            {% if mode == 'view' %}
                ::
                <a href="{% url 'links-edit' key %}#{{ subject }}">—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
            {% endif %}
        </div>

        <div style="margin-left: 10px;">
        {% for category, category_data in subject_data.items %}
            <h3 class="h6">
                {% if category == 'eng' %}
                    üá¨üáß –ê–Ω–≥–ª—ñ–π—Å—å–∫–∏–π –ø–æ—Ç—ñ–∫
                {% elif category == 'ukr' %}
                    üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –ø–æ—Ç—ñ–∫
                {% elif category == 'core' or category == 'alt' %}

                {% else %}
                    {{ category }}
                {% endif %}
            </h3>

            <table class="table table-bordered mb-4">
                <tbody>
                {% for data in category_data %}
                    <tr>
                        <td style="width: 30%;">
                            <label for="{{ subject }}|{{ category }}|{{ data.title }}|{{ data.teacher }}">
                                {{ data.title }}
                            </label>
                            <small>{{ data.teacher|teachers }}</small>
                        </td>
                        <td class="align-middle">
                            {% if mode == 'view' %}
                                {{ data.links|links }}
                            {% else %}
                                <div class="form-group">
                                    <textarea name="{{ subject }}|{{ category }}|{{ data.title }}|{{ data.teacher }}" id="{{ subject }}|{{ category }}|{{ data.title }}|{{ data.teacher }}"
                                              class="form-control textarea" rows="2" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç—É—Ç...">{{ data.links }}</textarea>
                                </div>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endfor %}
        {% if mode == 'edit' and not forloop.last %}
            <div class="silver-links small text-end" style="margin-top: -15px;">
                <a href="#save-bottom">‚Üì –≤–Ω–∏–∑ –¥–æ –∫–Ω–æ–ø–∫–∏ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è</a>
            </div>
        {% endif %}
        </div>
    {% empty %}
        –ü–æ–º–∏–ª–∫–∞: –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòÖ
    {% endfor %}

    {% if mode == 'edit' and subjects %}
        <div id="save-bottom" class="mt-5">
            {% include 'includes/buttons.html' %}
        </div>
    </form>
    {% endif %}
{% endblock %}

{% block js %}
    <script>
        const all_textarea = document.querySelectorAll('.textarea');

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –≤–∏—Å–æ—Ç–∏ textarea
        all_textarea.forEach(function(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';

            textarea.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        });
    </script>
{% endblock %}
